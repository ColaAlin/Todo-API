const axios = require('axios');
const axiosConfig = require('./.todoapiconfig.js');

let TodoAPI = (() => {
  let axiosInstance;
  const initialize = () => {
    axiosInstance = axios.create(axiosConfig);
  };
  const login = (userDetails) => {
    return axiosInstance.post('http://localhost:3000/users/login', {
      email: userDetails.email,
      password: userDetails.password
    }).then(result => result.data)
      .then(result => {
        axios.defaults.headers.common['Authorization'] = `Bearer ${result.token}`;
        return result;
      })
      .catch(error => error.response.status);
  };
  const logout = () => {
    return axiosInstance.post('/users/logout')
      .then(result => result.data)
      .catch(error => error.response.status);
  };
  const me = () => {
    return axiosInstance.get('/users/me')
      .then(result => result.data)
      .catch(error => error.response.status);
  };
  const updateUserDetails = (userDetails) => {
    return axiosInstance.patch('/users/me', {
      ...userDetails
    }).then(result => result.data)
      .catch(error => error.response.status);
  };
  const deleteMe = () => {
    return axiosInstance.delete('/users/me')
      .then(result => result.data)
      .catch(error => error.reponse.status);
  };
  return {
    initialize,
    login,
    logout,
    me,
    updateUserDetails,
    deleteMe
  };
})();

module.exports = TodoAPI;
